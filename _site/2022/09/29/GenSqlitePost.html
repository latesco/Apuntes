<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Python, Generadores y SQLite | Apuntes</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Python, Generadores y SQLite" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Dos Maneras de Consultar un Archivo sin Cargarlo a RAM" />
<meta property="og:description" content="Dos Maneras de Consultar un Archivo sin Cargarlo a RAM" />
<link rel="canonical" href="http://localhost:4000/apuntes/2022/09/29/GenSqlitePost.html" />
<meta property="og:url" content="http://localhost:4000/apuntes/2022/09/29/GenSqlitePost.html" />
<meta property="og:site_name" content="Apuntes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-09-29T01:55:51-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Python, Generadores y SQLite" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-29T01:55:51-04:00","datePublished":"2022-09-29T01:55:51-04:00","description":"Dos Maneras de Consultar un Archivo sin Cargarlo a RAM","headline":"Python, Generadores y SQLite","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/apuntes/2022/09/29/GenSqlitePost.html"},"url":"http://localhost:4000/apuntes/2022/09/29/GenSqlitePost.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/apuntes/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/apuntes/feed.xml" title="Apuntes" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/apuntes/">Apuntes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/apuntes/about/">Acerca</a><a class="page-link" href="/apuntes/about/">Acerca</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Python, Generadores y SQLite</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-09-29T01:55:51-04:00" itemprop="datePublished">Sep 29, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="dos-maneras-de-consultar-un-archivo-sin-cargarlo-a-ram">Dos Maneras de Consultar un Archivo sin Cargarlo a RAM</h2>

<p>Ocasionalmente puede resultar conveniente evitar posibles congestiones en la memoria del computador; los generadores y SQLite, son dos recursos que, entre otras cosas, permiten efectuar cálculos sobre un archivo sin cargarlo a la memoria RAM.</p>

<h3 id="generadores">Generadores</h3>

<p>Un generador, es una función que se comporta a la manera de un objeto sobre el cual es posible hacer iteraciones. En el caso particular de un archivo de datos, tiene una conexion con la ruta del archivo, entregando un solo resultado a la vez; con la ayuda de un <i>bucle</i> podrán hacerse calculos sobre filas o columnas.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">p0</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">getsize</span><span class="p">(</span><span class="s">'./data/OnlineRetail.csv'</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span> <span class="o">+</span> <span class="s">' Mb'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>43.99 Mb
</code></pre></div></div>

<p>Este archivo separado por comas, no es muy grande realmente; pero sirve como ejemplo, puede obtenerse facilmente a través de  internet.</p>

<p>Con la línea de código, ejecutada en la celda inferior, creamos un generador. Es la misma sintaxis de una <i>list comprehension</i>, solo que encapsulada en parentesis, en lugar de corchetes.</p>

<p>El <i>encoding</i>, es necesario debido a que el formato del archivo separa las columnas con ‘;’ en vez de ‘,’.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">genr</span> <span class="o">=</span> <span class="p">(</span><span class="n">fila</span> <span class="k">for</span> <span class="n">fila</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./data/OnlineRetail.csv'</span><span class="p">,</span>
                              <span class="n">encoding</span> <span class="o">=</span> <span class="s">'ISO-8859-1'</span><span class="p">))</span>
</code></pre></div></div>

<p>Este archivo permite la separación por columnas, y guarda el encabezado del archivo <i>OnlineRetail.csv</i> en el objeto <i>cols</i></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">genr</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">rstrip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">';'</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">genr</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">genr</span><span class="p">)</span>

<span class="n">cols</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['InvoiceNo',
 'StockCode',
 'Description',
 'Quantity',
 'InvoiceDate',
 'UnitPrice',
 'CustomerID',
 'Country']
</code></pre></div></div>

<p>Esto siguiente, es equivalente a consultar la primera fila del archivo, después del encabezado.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dct</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">genr</span><span class="p">)</span>

<span class="nb">next</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'InvoiceNo': '536365',
 'StockCode': '85123A',
 'Description': 'WHITE HANGING HEART T-LIGHT HOLDER',
 'Quantity': '6',
 'InvoiceDate': '01/12/2010 08:26',
 'UnitPrice': '2,55',
 'CustomerID': '17850',
 'Country': 'United Kingdom'}
</code></pre></div></div>

<p>La indole de los generadores hace que solo puedan hacerse lecturas de modo progresivo; es decir, una vez que lees una fila, ya solo te entregará la siguiente. De lo contrario debes repetir el proceso. Como en el caso siguiente:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">genr</span> <span class="o">=</span> <span class="p">(</span><span class="n">fila</span> <span class="k">for</span> <span class="n">fila</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./data/OnlineRetail.csv'</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">'ISO-8859-1'</span><span class="p">))</span>
<span class="n">genr</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">rstrip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">';'</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">genr</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">genr</span><span class="p">)</span>
<span class="n">dct</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">genr</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">dct</span><span class="p">))</span> <span class="o">+</span> <span class="s">' bytes'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>112 bytes
</code></pre></div></div>

<p>Vemos que lo que el peso del generador en la memoria es apenas una infima fracción del archivo.</p>

<p>Calculémos, por ejemplo, el total de la cantidad de mercancias vendidas en el Reino Unido:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">'Quantity'</span><span class="p">])</span>  <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dct</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s">'Country'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'United Kingdom'</span><span class="p">)</span>

<span class="nb">sum</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4263829
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">genr</span> <span class="o">=</span> <span class="p">(</span><span class="n">fila</span> <span class="k">for</span> <span class="n">fila</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./data/OnlineRetail.csv'</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">'ISO-8859-1'</span><span class="p">))</span>
<span class="n">genr</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">rstrip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">';'</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">genr</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">genr</span><span class="p">)</span>
<span class="n">dct</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">genr</span><span class="p">)</span>


<span class="n">Ventas</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">'Quantity'</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">'UnitPrice'</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">'.'</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">)</span>

<span class="nb">sum</span><span class="p">(</span><span class="n">Ventas</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>9747747.93400317
</code></pre></div></div>

<p>Claro está, dependiendo de los cálculos que se quieran hacer, este método puede no ser el más cómodo del mundo.</p>

<p>Sin embargo, <i>SQLite</i> ofrece muchas ventajas en cuanto a facilidad para hacer muchas operaciones.</p>

<h3 id="sqlite">SQLite</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruta</span> <span class="o">=</span> <span class="s">'./data/OnlineRetail.csv'</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">'./data/'</span><span class="p">,</span> <span class="s">'OnlineRetail.db'</span><span class="p">))</span>

<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
</code></pre></div></div>

<p>Con <i>sqlite</i> puede crearse una base de datos, sin servidor. Incluso puede crearse en la memoria del computador; claro que para este ejemplo, eso sería contradictorio con el propósito de no congestionar la memoria RAM.</p>

<p>El siguiente <i>bucle</i> importa fracciones del archivo y las agrega a una base de datos <i>sqlite</i>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">parte</span> <span class="ow">in</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ruta</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">'ISO-8859-1'</span><span class="p">,</span>
                        <span class="n">sep</span> <span class="o">=</span> <span class="s">';'</span><span class="p">,</span>
                        <span class="n">decimal</span> <span class="o">=</span> <span class="s">','</span><span class="p">,</span>
                        <span class="n">chunksize</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>
    <span class="n">parte</span><span class="p">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s">'onlineretail'</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s">'append'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">r</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">parte</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="s">' Mb'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.15 Mb
</code></pre></div></div>

<p>Lo que queda cargado es solo una fracción de 409 filas</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">parte</span><span class="p">.</span><span class="n">shape</span> <span class="c1"># las últimas 409 filas del archivo
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(409, 8)
</code></pre></div></div>

<p>De las cuales se puede prescindir impunemente.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">del</span> <span class="n">parte</span> 
</code></pre></div></div>

<p>Ahora se pueden ejecutar todo tipo de consultas sobre el archivo convertido a base de datos.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"""SELECT SUM(UnitPrice * Quantity) FROM onlineretail;
            """</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span> <span class="c1"># EL mismo cálculo hecho arriba con generadores
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[(9747747.93400317,)]
</code></pre></div></div>

<p>El número de registros o transacciones por países.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"""SELECT Country, COUNT(*) as N
            from onlineretail
            GROUP BY Country
            ORDER BY N DESC;
            """</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[('United Kingdom', 495478),
 ('Germany', 9495),
 ('France', 8557),
 ('EIRE', 8196),
 ('Spain', 2533),
 ('Netherlands', 2371),
 ('Belgium', 2069),
 ('Switzerland', 2002),
 ('Portugal', 1519),
 ('Australia', 1259),
 ('Norway', 1086),
 ('Italy', 803),
 ('Channel Islands', 758),
 ('Finland', 695),
 ('Cyprus', 622),
 ('Sweden', 462),
 ('Unspecified', 446),
 ('Austria', 401),
 ('Denmark', 389),
 ('Japan', 358),
 ('Poland', 341),
 ('Israel', 297),
 ('USA', 291),
 ('Hong Kong', 288),
 ('Singapore', 229),
 ('Iceland', 182),
 ('Canada', 151),
 ('Greece', 146),
 ('Malta', 127),
 ('United Arab Emirates', 68),
 ('European Community', 61),
 ('RSA', 58),
 ('Lebanon', 45),
 ('Lithuania', 35),
 ('Brazil', 32),
 ('Czech Republic', 30),
 ('Bahrain', 19),
 ('Saudi Arabia', 10)]
</code></pre></div></div>

<p>Pero <i>Pandas</i> tiene un método <i>.read_sql</i> que convierte el resultado de una <i>query</i> en <i>dataframe</i>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s">"""SELECT Country, COUNT(*) as N
            from onlineretail
            GROUP BY Country
            ORDER BY N DESC;
            """</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>

<span class="n">ds</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>N</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>United Kingdom</td>
      <td>495478</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Germany</td>
      <td>9495</td>
    </tr>
    <tr>
      <th>2</th>
      <td>France</td>
      <td>8557</td>
    </tr>
    <tr>
      <th>3</th>
      <td>EIRE</td>
      <td>8196</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Spain</td>
      <td>2533</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Netherlands</td>
      <td>2371</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Belgium</td>
      <td>2069</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Switzerland</td>
      <td>2002</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Portugal</td>
      <td>1519</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Australia</td>
      <td>1259</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Norway</td>
      <td>1086</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Italy</td>
      <td>803</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Channel Islands</td>
      <td>758</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Finland</td>
      <td>695</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Cyprus</td>
      <td>622</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Sweden</td>
      <td>462</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Unspecified</td>
      <td>446</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Austria</td>
      <td>401</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Denmark</td>
      <td>389</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Japan</td>
      <td>358</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Poland</td>
      <td>341</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Israel</td>
      <td>297</td>
    </tr>
    <tr>
      <th>22</th>
      <td>USA</td>
      <td>291</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Hong Kong</td>
      <td>288</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Singapore</td>
      <td>229</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Iceland</td>
      <td>182</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Canada</td>
      <td>151</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Greece</td>
      <td>146</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Malta</td>
      <td>127</td>
    </tr>
    <tr>
      <th>29</th>
      <td>United Arab Emirates</td>
      <td>68</td>
    </tr>
    <tr>
      <th>30</th>
      <td>European Community</td>
      <td>61</td>
    </tr>
    <tr>
      <th>31</th>
      <td>RSA</td>
      <td>58</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Lebanon</td>
      <td>45</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Lithuania</td>
      <td>35</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Brazil</td>
      <td>32</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Czech Republic</td>
      <td>30</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Bahrain</td>
      <td>19</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Saudi Arabia</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>

<p>Total de ingresos, cantidades y promedio de precios por países</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s">"""SELECT Country, SUM(Quantity * UnitPrice) AS ingresos,
            SUM(Quantity) AS Cantidad, AVG(UnitPrice) AS precio
            FROM onlineretail
            GROUP BY Country;"""</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>

<span class="n">ds</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>ingresos</th>
      <th>Cantidad</th>
      <th>precio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Australia</td>
      <td>1.370773e+05</td>
      <td>83653</td>
      <td>3.220612</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Austria</td>
      <td>1.015432e+04</td>
      <td>4827</td>
      <td>4.243192</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Bahrain</td>
      <td>5.484000e+02</td>
      <td>260</td>
      <td>4.556316</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Belgium</td>
      <td>4.091096e+04</td>
      <td>23152</td>
      <td>3.644335</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Brazil</td>
      <td>1.143600e+03</td>
      <td>356</td>
      <td>4.456250</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Canada</td>
      <td>3.666380e+03</td>
      <td>2763</td>
      <td>6.030331</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Channel Islands</td>
      <td>2.008629e+04</td>
      <td>9479</td>
      <td>4.932124</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Cyprus</td>
      <td>1.294629e+04</td>
      <td>6317</td>
      <td>6.302363</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Czech Republic</td>
      <td>7.077200e+02</td>
      <td>592</td>
      <td>2.938333</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Denmark</td>
      <td>1.876814e+04</td>
      <td>8188</td>
      <td>3.256941</td>
    </tr>
    <tr>
      <th>10</th>
      <td>EIRE</td>
      <td>2.632768e+05</td>
      <td>142637</td>
      <td>5.911077</td>
    </tr>
    <tr>
      <th>11</th>
      <td>European Community</td>
      <td>1.291750e+03</td>
      <td>497</td>
      <td>4.820492</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Finland</td>
      <td>2.232674e+04</td>
      <td>10666</td>
      <td>5.448705</td>
    </tr>
    <tr>
      <th>13</th>
      <td>France</td>
      <td>1.974039e+05</td>
      <td>110480</td>
      <td>5.028864</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Germany</td>
      <td>2.216982e+05</td>
      <td>117448</td>
      <td>3.966930</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Greece</td>
      <td>4.710520e+03</td>
      <td>1556</td>
      <td>4.885548</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Hong Kong</td>
      <td>1.011704e+04</td>
      <td>4769</td>
      <td>42.505208</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Iceland</td>
      <td>4.310000e+03</td>
      <td>2458</td>
      <td>2.644011</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Israel</td>
      <td>7.907820e+03</td>
      <td>4353</td>
      <td>3.633131</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Italy</td>
      <td>1.689051e+04</td>
      <td>7999</td>
      <td>4.831121</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Japan</td>
      <td>3.534062e+04</td>
      <td>25218</td>
      <td>2.276145</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Lebanon</td>
      <td>1.693880e+03</td>
      <td>386</td>
      <td>5.387556</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Lithuania</td>
      <td>1.661060e+03</td>
      <td>652</td>
      <td>2.841143</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Malta</td>
      <td>2.505470e+03</td>
      <td>944</td>
      <td>5.244173</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Netherlands</td>
      <td>2.846615e+05</td>
      <td>200128</td>
      <td>2.738317</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Norway</td>
      <td>3.516346e+04</td>
      <td>19247</td>
      <td>6.012026</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Poland</td>
      <td>7.213140e+03</td>
      <td>3653</td>
      <td>4.170880</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Portugal</td>
      <td>2.936702e+04</td>
      <td>16180</td>
      <td>8.582976</td>
    </tr>
    <tr>
      <th>28</th>
      <td>RSA</td>
      <td>1.002310e+03</td>
      <td>352</td>
      <td>4.277586</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Saudi Arabia</td>
      <td>1.311700e+02</td>
      <td>75</td>
      <td>2.411000</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Singapore</td>
      <td>9.120390e+03</td>
      <td>5234</td>
      <td>109.645808</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Spain</td>
      <td>5.477458e+04</td>
      <td>26824</td>
      <td>4.987544</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Sweden</td>
      <td>3.659591e+04</td>
      <td>35637</td>
      <td>3.910887</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Switzerland</td>
      <td>5.638535e+04</td>
      <td>30325</td>
      <td>3.403442</td>
    </tr>
    <tr>
      <th>34</th>
      <td>USA</td>
      <td>1.730920e+03</td>
      <td>1034</td>
      <td>2.216426</td>
    </tr>
    <tr>
      <th>35</th>
      <td>United Arab Emirates</td>
      <td>1.902280e+03</td>
      <td>982</td>
      <td>3.380735</td>
    </tr>
    <tr>
      <th>36</th>
      <td>United Kingdom</td>
      <td>8.187806e+06</td>
      <td>4263829</td>
      <td>4.532422</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Unspecified</td>
      <td>4.749790e+03</td>
      <td>3300</td>
      <td>2.699574</td>
    </tr>
  </tbody>
</table>
</div>


  </div><a class="u-url" href="/apuntes/2022/09/29/GenSqlitePost.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/apuntes/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Apuntes</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Apuntes</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/latesco"><svg class="svg-icon"><use xlink:href="/apuntes/assets/minima-social-icons.svg#github"></use></svg> <span class="username">latesco</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Códigos de Python.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
