<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Excel a través de Python | Apuntes</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Excel a través de Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Python, Openpyxl" />
<meta property="og:description" content="Python, Openpyxl" />
<link rel="canonical" href="http://localhost:4000/apuntes/2023/07/15/XLatravespython.html" />
<meta property="og:url" content="http://localhost:4000/apuntes/2023/07/15/XLatravespython.html" />
<meta property="og:site_name" content="Apuntes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-07-15T10:45:15-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Excel a través de Python" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-07-15T10:45:15-04:00","datePublished":"2023-07-15T10:45:15-04:00","description":"Python, Openpyxl","headline":"Excel a través de Python","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/apuntes/2023/07/15/XLatravespython.html"},"url":"http://localhost:4000/apuntes/2023/07/15/XLatravespython.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/apuntes/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/apuntes/feed.xml" title="Apuntes" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/apuntes/">Apuntes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/apuntes/about/">Acerca de</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Excel a través de Python</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-07-15T10:45:15-04:00" itemprop="datePublished">Jul 15, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="python-openpyxl"><i>Python</i>, <i>Openpyxl</i></h2>

<p><i>Openpyxl</i>, es una librería de <i>Python</i> para lectura y escritura de archivos en <i>Excel</i>— no es la única, pero si pionera —; tiene capacidades que ofrecen la posibilidad de convertir actividades repetitivas y tediosas en un proceso mucho más simple y rápido.</p>

<p>Se trata de operaciones que pueden ejecutarse directamente sobre la hoja de cálculo, y que incluso podrían resultar triviales para quienes sean usuarios habituales de  Excel; pero que de ser necesario repetirlas muchas veces, sobre distintas hojas o libros de excel, pueden tornarse muy tediosas y con alta propensión a errores.</p>

<p>Existe <i>VBA</i> <i>(macros)</i>, por supuesto, pero <i>Python</i> — a través de varios de sus paquetes, <i>openpyxl</i> entre ellos —  es visto como una buena alternativa (y quiza, posible sustituto); sobre todo para  quienes realicen en Excel tareas que involucren <i>data cleaning</i> (trad. literal limpieza de datos) y reportes.</p>

<p>Las funciones disponibles de este paquete son muchas y variadas. Vale la pena consultar la <a href="https://openpyxl.readthedocs.io/en/stable/tutorial.html">documentación</a> que es bastante explicita sobre su instalación y uso.</p>

<h3 id="ejemplo">Ejemplo</h3>

<p>A modo de ilustración de lo dicho arriba. Considerémos los siguientes datos, guardados en un libro de excel llamado ‘Ejemplo01.xlsx’.</p>

<div>
  <img src="https://github.com/latesco/apuntes/blob/gh-pages/_posts/2023/07/15/assets/output_10_0.png?raw=true" /> 
</div>

<p>Son datos ficticios de unas ‘ventas mensuales’. Suponiendo que sobre un archivo como este deban efectuarse algunos cálculos y operaciones de formato: total columna ‘B’ y agregar otra columna en ‘C’ con los cambios porcentuales; una tabla para el conteo de meses con cambio porcentual negativo; y además añadir algunos gráficos y formato a la hoja (encabezado: titulo, colores, etc). Teniendo previamente preparadas las funciones convenientes. el procedimiento se reduce simplemente a la ejecución de los siguientes comandos.</p>

<p>Importamos el libro de excel, escr:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span> <span class="o">=</span> <span class="n">formato_calculo</span><span class="p">(</span><span class="s">'Ejemplo01.xlsx'</span><span class="p">)</span>
</code></pre></div></div>

<p>Procesamos los cálculos: el total y la columna de cambios porcentuales</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span><span class="p">.</span><span class="n">total</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Worksheet "Despues"&gt;
</code></pre></div></div>

<p>Añadimos un titulo a la hoja y le damos un color a los encabezados</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span><span class="p">.</span><span class="n">formatos</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Worksheet "Despues"&gt;
</code></pre></div></div>

<p>Ahora agregamos dos gráficos:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span><span class="p">.</span><span class="n">grafico_linea</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Worksheet "Despues"&gt;
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span><span class="p">.</span><span class="n">grafico_barra</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Worksheet "Despues"&gt;
</code></pre></div></div>

<p>Y guardámos los cambios, puede ser en otro libro o el mismo libro excel, actualmente abierto.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span><span class="p">.</span><span class="n">libro</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'Ejemplo01_Procesado.xlsx'</span><span class="p">)</span>
</code></pre></div></div>

<p>El <i>gif</i> muestra la hoja de cálculo ‘antes’, con los datos originales, y la hoja ‘después’ con los resultados de las operaciones hechas arriba.</p>

<div>
  <img src="https://github.com/latesco/apuntes/blob/gh-pages/_posts/2023/07/15/assets/xl_final.gif?raw=true" />
</div>

<p>Como vemos, puede ahorrarse bastante tiempo, si las operaciones a realizar pueden ser preparadas por adelantado; esto no siempre es posible, pero en muchos casos si lo es.</p>

<p>En las líneas siguientes se  describe la codificación prevía necesaria para crear la clase <i>formato_calculo</i>, usada en el ejemplo de arriba.</p>

<h3 id="algunas-funciones"><i>Algunas funciones</i>:</h3>

<p>Usarémos los siguientes datos para mostrar el uso de algunas funciones, valores distintos, pero lo importante es que sea la misma estructura.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">datos</span> <span class="o">=</span> <span class="p">[[</span><span class="s">'Mes'</span><span class="p">,</span> <span class="s">'Monto'</span><span class="p">],</span> <span class="p">[</span><span class="s">'Ene'</span><span class="p">,</span> <span class="mi">411</span><span class="p">],</span> <span class="p">[</span><span class="s">'Feb'</span><span class="p">,</span> <span class="mi">536</span><span class="p">],</span> <span class="p">[</span><span class="s">'Mar'</span><span class="p">,</span> <span class="mi">467</span><span class="p">],</span> <span class="p">[</span><span class="s">'Abr'</span><span class="p">,</span> <span class="mi">460</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'May'</span><span class="p">,</span> <span class="mi">370</span><span class="p">],</span> <span class="p">[</span><span class="s">'Jun'</span><span class="p">,</span> <span class="mi">385</span><span class="p">],[</span><span class="s">'Jul'</span><span class="p">,</span> <span class="mi">478</span><span class="p">],</span> <span class="p">[</span><span class="s">'Ago'</span><span class="p">,</span> <span class="mi">493</span><span class="p">],</span> <span class="p">[</span><span class="s">'Sep'</span><span class="p">,</span> <span class="mi">615</span><span class="p">],</span> <span class="p">[</span><span class="s">'Oct'</span><span class="p">,</span> <span class="mi">620</span><span class="p">],</span>
        <span class="p">[</span><span class="s">'Nov'</span><span class="p">,</span> <span class="mi">630</span><span class="p">],</span> <span class="p">[</span><span class="s">'Dic'</span><span class="p">,</span> <span class="mi">650</span><span class="p">]]</span>
</code></pre></div></div>

<p>Para crear un libro de excel se procede del modo siguiente.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">Workbook</span>
</code></pre></div></div>

<p>Usando este modulo <i>Workbook</i>, creamos un libro que puede trabajarse desde el editor de texto.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lib</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">()</span>
</code></pre></div></div>

<p>Para ingresar los datos, en este caso, conviene usar usar un <i>bucle</i> <i>(for loop)</i>, sobre un objeto que representa la hoja de calculo activa en el libro excel.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ho</span> <span class="o">=</span> <span class="n">lib</span><span class="p">.</span><span class="n">active</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">datos</span><span class="p">:</span>
    <span class="n">ho</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></div>

<p>Para guardar el libro.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lib</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'Ejemplo02.xlsx'</span><span class="p">)</span>
</code></pre></div></div>

<p>Si, en lugar de crear un libro Excel, se trata mas bien de importarlo, el procedimiento es:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s">'Ejemplo02.xlsx'</span><span class="p">)</span>
</code></pre></div></div>

<p>En el objeto ‘hoja’ guardamos la hoja de cálculo activa del libro cargado y le damos por nombre ‘Ventas’.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span> <span class="o">=</span> <span class="n">libro</span><span class="p">.</span><span class="n">active</span>
<span class="n">hoja</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'Ventas'</span>
</code></pre></div></div>

<p>Insertamos dos filas, en la parte superior de la hoja, y añadimos un texto a la celda ‘A1’ que servirá de titulo para la hoja de cálculo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span><span class="p">.</span><span class="n">insert_rows</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
<span class="n">hoja</span><span class="p">[</span><span class="s">'A1'</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Montos Mensuales"</span>
        
<span class="n">hoja</span><span class="p">.</span><span class="n">merge_cells</span><span class="p">(</span><span class="n">start_row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                  <span class="n">start_column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                  <span class="n">end_row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                  <span class="n">end_column</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<p>Calculamos el total de la columna ‘B’ y lo ingresamos en la celda ‘B17’.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span><span class="p">[</span><span class="s">'A17'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Total'</span>

<span class="n">hoja</span><span class="p">[</span><span class="s">'B17'</span><span class="p">]</span> <span class="o">=</span> <span class="s">"=SUM(B4:B15)"</span> <span class="c1"># fórmula
</span>
</code></pre></div></div>

<p>Añadimos otra columna, correspondiente a la letra ‘C’ de la hoja, que contendrá los cambios porcentuales entre las cantidades presentes en la columna ‘B’ de la hoja de cálculo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">maxfila</span> <span class="o">=</span> <span class="n">hoja</span><span class="p">.</span><span class="n">max_row</span> <span class="o">-</span> <span class="mi">1</span>

<span class="n">hoja</span><span class="p">[</span><span class="s">'C3'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Pct'</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">maxfila</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">hoja</span><span class="p">[</span><span class="sa">f</span><span class="s">"C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hoja</span><span class="p">[</span><span class="sa">f</span><span class="s">"C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"=ROUND((B</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s"> / B</span><span class="si">{</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="si">}</span><span class="s"> - 1) * 100, 2)"</span>
</code></pre></div></div>

<p>Ahora creamos una pequeña tabla que contendrá la cantidad de meses con cambios porcentuales negativos y positivos.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span><span class="p">[</span><span class="s">'A21'</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Conteos"</span>

<span class="n">hoja</span><span class="p">[</span><span class="s">'A22'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Positivos'</span>

<span class="n">hoja</span><span class="p">[</span><span class="s">'A23'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Negativos'</span>

<span class="n">hoja</span><span class="p">[</span><span class="s">'A24'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Ceros'</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span><span class="p">[</span><span class="s">'B22'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'=COUNTIF($C$4:$C$15,"&gt;0")'</span>

<span class="n">hoja</span><span class="p">[</span><span class="s">'B23'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'=COUNTIF($C$4:$C$15,"&lt;0")'</span>

<span class="n">hoja</span><span class="p">[</span><span class="s">'B24'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'=COUNTIF($C$4:$C$15,"0")'</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'Ejemplo02_Proc.xlsx'</span><span class="p">)</span>
</code></pre></div></div>

<p>Al guardar los cambios y abrir el libro en Excel.<br /></p>

<div>
 
  <img src="https://github.com/latesco/apuntes/blob/gh-pages/_posts/2023/07/15/assets/output_54_0.png?raw=true" /> 
  
</div>
<p><br /></p>

<p>Con esto, los resultados y las operaciones de cálculo de porcentaje y suma, que nos propusimos hacer, ya se encuentran en el libro. Ahora corresponden los pasos para el formato y añadir colores.</p>

<p>### Formatos</p>

<p>Para dar el formato a la hoja, necesitarémos algunos modulos extra de la librería <i>Openpyxl</i></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">openpyxl.utils</span> <span class="kn">import</span> <span class="n">get_column_letter</span>

<span class="kn">from</span> <span class="nn">openpyxl.styles</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Font</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Alignment</span><span class="p">,</span>
    <span class="n">Border</span><span class="p">,</span> <span class="n">Side</span><span class="p">,</span>
    <span class="n">PatternFill</span><span class="p">,</span>
    <span class="n">NamedStyle</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>Si se decide deshechar los bordes de celdas.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span><span class="p">.</span><span class="n">sheet_view</span><span class="p">.</span><span class="n">showGridLines</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre></div></div>

<p>Cada uno de los modulos importados arriba sirve para controlar alguna caraćterística de la hoja excel que deseémos modificar: <i>Font</i> tiene que ver con el tamaño color y tipo de fuente; <i>Border</i>, para cambiar los bordes de las celdas; <i>PatternFill</i>, permite cambiar el color de la celda; y <i>NamedStyle</i>, permite agrupar varias características como un estilo, para luego aplicarlo en conjunto a una celda en especifíco.</p>

<p>La funcion <i>NamedStyle</i>, sirve para crear un objeto que agrupa todo un conjunto de características que definimos con las funciones de arriba en un ‘estilo’ dado.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">enc</span> <span class="o">=</span> <span class="n">NamedStyle</span><span class="p">(</span><span class="s">'enc'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">enc</span><span class="p">.</span><span class="n">border</span> <span class="o">=</span> <span class="n">Border</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">border_style</span><span class="o">=</span><span class="s">'double'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">),</span> 
                      <span class="n">top</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">border_style</span><span class="o">=</span><span class="s">'double'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">enc</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">)</span>


<span class="n">enc</span><span class="p">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span>
                                    <span class="n">vertical</span><span class="o">=</span> <span class="s">'center'</span><span class="p">)</span>
        
<span class="n">enc</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">PatternFill</span><span class="p">(</span><span class="n">fgColor</span> <span class="o">=</span> <span class="s">"003366"</span><span class="p">,</span>
                             <span class="n">fill_type</span><span class="o">=</span><span class="s">'solid'</span><span class="p">)</span>
</code></pre></div></div>

<p>El siguiente <i>loop</i> le asigna las características creadas arriba a los encabezados de las 3 columnas.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
    <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">enc</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span>
    
    <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">enc</span>
</code></pre></div></div>

<p>Reduciendo la altura de la fila 16.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span><span class="p">.</span><span class="n">row_dimensions</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">7</span>
</code></pre></div></div>

<p>Incrementando la altura de las filas 3 y 17.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span><span class="p">.</span><span class="n">row_dimensions</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">hoja</span><span class="p">.</span><span class="n">row_dimensions</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">22</span>
</code></pre></div></div>

<p>A continuación agregamos formato al titulo de la hoja de cálculo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">enc2</span> <span class="o">=</span>  <span class="n">NamedStyle</span><span class="p">(</span><span class="s">'enc2'</span><span class="p">)</span>

<span class="n">enc2</span><span class="p">.</span><span class="n">border</span> <span class="o">=</span> <span class="n">Border</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">border_style</span><span class="o">=</span><span class="s">'thick'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">),</span> 
                      <span class="n">top</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">border_style</span><span class="o">=</span><span class="s">'thick'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">))</span>

<span class="n">enc2</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">)</span>

<span class="n">enc2</span><span class="p">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span>
                                    <span class="n">vertical</span><span class="o">=</span> <span class="s">'center'</span><span class="p">)</span>
        
<span class="n">enc2</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">PatternFill</span><span class="p">(</span><span class="n">fgColor</span> <span class="o">=</span> <span class="s">"003366"</span><span class="p">,</span>
                             <span class="n">fill_type</span><span class="o">=</span><span class="s">'solid'</span><span class="p">)</span>


</code></pre></div></div>

<p>El <i>bucle</i> le asigna las características arriba especificadas a las celdas de interés, las correspondientes a las 2 primeras filas, cuyas celdas fueron combinadas más arriba.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        
        <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">enc2</span>
</code></pre></div></div>

<p>Aumentamos el ancho de columnas; <i>get_column_letter</i>, es una función que al darle un número retorna la letra de la columna correspondiente a ese número; resulta útil en <i>bucles</i>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hoja</span><span class="p">.</span><span class="n">max_column</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    
    <span class="n">idx_col</span> <span class="o">=</span> <span class="n">get_column_letter</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    
    <span class="n">hoja</span><span class="p">.</span><span class="n">column_dimensions</span><span class="p">[</span><span class="n">idx_col</span><span class="p">].</span><span class="n">width</span> <span class="o">=</span> <span class="mi">14</span>
</code></pre></div></div>

<p>El siguiente procedimiento cambiará la alineación, aumentará la fuente y le dará color distinto a las filas impares.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fila</span> <span class="o">=</span> <span class="n">NamedStyle</span><span class="p">(</span><span class="s">'ffila'</span><span class="p">)</span>

<span class="n">fila</span><span class="p">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span>
                            <span class="n">vertical</span><span class="o">=</span><span class="s">'center'</span><span class="p">)</span>
        
<span class="n">fila</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filapar</span> <span class="o">=</span> <span class="n">PatternFill</span><span class="p">(</span><span class="n">fgColor</span> <span class="o">=</span> <span class="s">'ecf7f9'</span><span class="p">,</span>
                   <span class="n">fill_type</span><span class="o">=</span><span class="s">'solid'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
        
        <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            
            <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">fila</span>
            
            <span class="n">celda</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">filapar</span>
            
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">fila</span>
</code></pre></div></div>

<p>Lo siguiente es para formatear las filas de la otra tabla para conteo de positivos y negativos.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span><span class="p">.</span><span class="n">merge_cells</span><span class="p">(</span><span class="n">start_row</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> 
                 <span class="n">start_column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                 <span class="n">end_row</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> 
                 <span class="n">end_column</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span>
    
    <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">enc</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
        
        <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            
            <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">fila</span>
            
            <span class="n">celda</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">filapar</span>
            
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">fila</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hoja</span><span class="p">.</span><span class="n">row_dimensions</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">22</span>
</code></pre></div></div>

<p>Guardámos los cambios</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'Ejemplo02_Proc.xlsx'</span><span class="p">)</span>
</code></pre></div></div>

<div>
 
  <img src="https://github.com/latesco/apuntes/blob/gh-pages/_posts/2023/07/15/assets/output_90_0.png?raw=true" /> 
</div>

<h3 id="gráficos">Gráficos</h3>

<p>Para añadir gráficos, existen varias alternativas: linea, barras, tortas, etc. Para cada una existe un modulo por separado, y la documentación de <i>Openpyxl</i> ofrece las especificaciones necesarias.<br /></p>

<p>En este caso usarémos <i>LineChart</i> y <i>BarChart</i>, pues se trata de gráficos de linea y barra. El modulo llamado <i>Reference</i>, se usa para contener los datos.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">openpyxl.chart</span> <span class="kn">import</span> <span class="n">BarChart</span><span class="p">,</span> <span class="n">LineChart</span><span class="p">,</span> <span class="n">Reference</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">linea</span> <span class="o">=</span> <span class="n">LineChart</span><span class="p">()</span>

<span class="n">linea</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"line"</span>
<span class="n">linea</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">linea</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Montos Mensuales"</span>
<span class="n">linea</span><span class="p">.</span><span class="n">y_axis</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'$'</span>
<span class="n">linea</span><span class="p">.</span><span class="n">x_axis</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'Mes'</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Reference</span><span class="p">(</span><span class="n">worksheet</span><span class="o">=</span><span class="n">hoja</span><span class="p">,</span>

                 <span class="n">min_row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>

                 <span class="n">max_row</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>

                 <span class="n">min_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>

                 <span class="n">max_col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">linea</span><span class="p">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">from_rows</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">titles_from_data</span><span class="o">=</span><span class="bp">True</span>
              <span class="p">)</span>

<span class="n">hoja</span><span class="p">.</span><span class="n">add_chart</span><span class="p">(</span><span class="n">linea</span><span class="p">,</span> <span class="s">"E3"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">barra</span> <span class="o">=</span> <span class="n">BarChart</span><span class="p">()</span>
<span class="n">barra</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"col"</span>
<span class="n">barra</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">barra</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Positivos y negativos"</span>
<span class="n">barra</span><span class="p">.</span><span class="n">y_axis</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'Conteo'</span>
<span class="n">barra</span><span class="p">.</span><span class="n">x_axis</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'Categoria'</span>


<span class="n">data1</span> <span class="o">=</span> <span class="n">Reference</span><span class="p">(</span><span class="n">worksheet</span><span class="o">=</span><span class="n">hoja</span><span class="p">,</span>

                 <span class="n">min_row</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span>

                 <span class="n">max_row</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>

                 <span class="n">min_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>

                 <span class="n">max_col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="n">barra</span><span class="p">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">titles_from_data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">hoja</span><span class="p">.</span><span class="n">add_chart</span><span class="p">(</span><span class="n">barra</span><span class="p">,</span> <span class="s">"E22"</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libro</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'Ejemplo02_Proc.xlsx'</span><span class="p">)</span>
</code></pre></div></div>

<p>Como vemos es posible controlar todo tipo de características de la hoja de cálculo con este paquete.</p>

<p>Los pasos anteriores pueden agruparse en una <i>clase</i>, para no tener que repetirlos de nuevo. La celda inferior muestra el código completo que se usó en el ejemplo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">Workbook</span>
<span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>
<span class="kn">from</span> <span class="nn">openpyxl.chart</span> <span class="kn">import</span> <span class="n">BarChart</span><span class="p">,</span> <span class="n">LineChart</span><span class="p">,</span> <span class="n">Reference</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">openpyxl.utils</span> <span class="kn">import</span> <span class="n">get_column_letter</span>
<span class="kn">from</span> <span class="nn">openpyxl.styles</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Font</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Alignment</span><span class="p">,</span>
    <span class="n">Border</span><span class="p">,</span> <span class="n">Side</span><span class="p">,</span>
    <span class="n">PatternFill</span><span class="p">,</span>
    <span class="n">NamedStyle</span>
    <span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">formato_calculo</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ruta_archivo</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">libro</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">ruta_archivo</span><span class="p">)</span>
        
        <span class="c1"># definiendo colores, bordes de celdas, etc.
</span>        
        <span class="n">enc</span> <span class="o">=</span> <span class="n">NamedStyle</span><span class="p">(</span><span class="s">'enc_col'</span><span class="p">)</span>
        
        <span class="n">enc</span><span class="p">.</span><span class="n">border</span> <span class="o">=</span> <span class="n">Border</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">border_style</span><span class="o">=</span><span class="s">'double'</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">),</span> 
                            <span class="n">top</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">border_style</span><span class="o">=</span><span class="s">'double'</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">))</span>
        
        <span class="n">enc</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">)</span>
        
        <span class="n">enc</span><span class="p">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span>
                                    <span class="n">vertical</span><span class="o">=</span> <span class="s">'center'</span><span class="p">)</span>
        
        <span class="n">enc</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">PatternFill</span><span class="p">(</span><span class="n">fgColor</span> <span class="o">=</span> <span class="s">"003366"</span><span class="p">,</span>
                             <span class="n">fill_type</span><span class="o">=</span><span class="s">'solid'</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">libro</span><span class="p">.</span><span class="n">add_named_style</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
        
        <span class="c1"># encabezados de columnas
</span>        
        <span class="n">enc2</span> <span class="o">=</span>  <span class="n">NamedStyle</span><span class="p">(</span><span class="s">'form_titulo'</span><span class="p">)</span>
        
        <span class="n">enc2</span><span class="p">.</span><span class="n">border</span> <span class="o">=</span> <span class="n">Border</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">border_style</span><span class="o">=</span><span class="s">'thick'</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">),</span> 
                             <span class="n">top</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">border_style</span><span class="o">=</span><span class="s">'thick'</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">))</span>
        
        <span class="n">enc2</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'ffffff'</span><span class="p">)</span>
        
        <span class="n">enc2</span><span class="p">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span>
                                    <span class="n">vertical</span><span class="o">=</span> <span class="s">'center'</span><span class="p">)</span>
        
        <span class="n">enc2</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">PatternFill</span><span class="p">(</span><span class="n">fgColor</span> <span class="o">=</span> <span class="s">"003366"</span><span class="p">,</span>
                             <span class="n">fill_type</span><span class="o">=</span><span class="s">'solid'</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="p">.</span><span class="n">libro</span><span class="p">.</span><span class="n">add_named_style</span><span class="p">(</span><span class="n">enc2</span><span class="p">)</span>
        
        <span class="c1"># formato del resto de filas
</span>        
        <span class="n">fl</span> <span class="o">=</span> <span class="n">NamedStyle</span><span class="p">(</span><span class="s">'form_fila'</span><span class="p">)</span>
        
        <span class="n">fl</span><span class="p">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span>
                                   
                                   <span class="n">vertical</span><span class="o">=</span><span class="s">'center'</span><span class="p">)</span>
        
        <span class="n">fl</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">libro</span><span class="p">.</span><span class="n">add_named_style</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        
        <span class="n">pag</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">libro</span><span class="p">.</span><span class="n">active</span>
        
        <span class="n">pag</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'Antes'</span>
        
        <span class="n">hoja</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">libro</span><span class="p">.</span><span class="n">copy_worksheet</span><span class="p">(</span><span class="n">pag</span><span class="p">)</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">insert_rows</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">hoja</span><span class="p">[</span><span class="s">'A1'</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Montos Mensuales"</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">merge_cells</span><span class="p">(</span><span class="n">start_row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                         <span class="n">start_column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                         <span class="n">end_row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                         <span class="n">end_column</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="n">maxfila</span> <span class="o">=</span> <span class="n">hoja</span><span class="p">.</span><span class="n">max_row</span>
        
        <span class="n">minfila</span> <span class="o">=</span> <span class="n">hoja</span><span class="p">.</span><span class="n">min_row</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'Despues'</span>
        
        <span class="n">loc_1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">maxfila</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># localización celda
</span>        
        <span class="n">loc_2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">minfila</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># localización celda
</span>        
        <span class="n">hoja</span><span class="p">[</span><span class="s">'A'</span><span class="o">+</span><span class="n">loc_1</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Total'</span>
        
        <span class="n">hoja</span><span class="p">[</span><span class="s">'B'</span><span class="o">+</span><span class="n">loc_1</span><span class="p">]</span> <span class="o">=</span> <span class="s">"=SUM(B4:B15)"</span>
        
        <span class="n">hoja</span><span class="p">[</span><span class="s">'C'</span><span class="o">+</span><span class="n">loc_2</span><span class="p">]</span> <span class="o">=</span> <span class="s">'C_Pct'</span> <span class="c1"># nombre columna cambio porcentual
</span>        
        <span class="c1"># cálculo cambio porcentual mes a mes columna C
</span>        <span class="n">min_nro_fila</span> <span class="o">=</span> <span class="n">minfila</span> <span class="o">+</span> <span class="mi">3</span>
        
        <span class="n">max_nro_fila</span> <span class="o">=</span> <span class="n">hoja</span><span class="p">.</span><span class="n">max_row</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># el rango no incluye el límite superior
</span>        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_nro_fila</span><span class="p">,</span> <span class="n">max_nro_fila</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                
                <span class="n">hoja</span><span class="p">[</span><span class="sa">f</span><span class="s">"C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                
            <span class="k">else</span><span class="p">:</span>
                
                <span class="n">hoja</span><span class="p">[</span><span class="sa">f</span><span class="s">"C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"=ROUND((B</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s"> / B</span><span class="si">{</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="si">}</span><span class="s"> - 1) * 100, 2)"</span>
                
        <span class="c1"># segunda tabla
</span>        
        <span class="n">ix01</span> <span class="o">=</span> <span class="n">hoja</span><span class="p">.</span><span class="n">min_row</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="n">ix02</span> <span class="o">=</span> <span class="n">hoja</span><span class="p">.</span><span class="n">max_row</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="n">hoja</span><span class="p">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">4</span>
        
        <span class="n">hoja</span><span class="p">[</span><span class="s">'A'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nf</span><span class="p">)]</span> <span class="o">=</span> <span class="s">"Conteos"</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">merge_cells</span><span class="p">(</span><span class="n">start_row</span><span class="o">=</span><span class="n">nf</span><span class="p">,</span> 
                 <span class="n">start_column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                 <span class="n">end_row</span><span class="o">=</span><span class="n">nf</span><span class="p">,</span> 
                 <span class="n">end_column</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">hoja</span><span class="p">[</span><span class="s">'A'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nf</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="s">'Positivos'</span>
        <span class="n">hoja</span><span class="p">[</span><span class="s">'A'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nf</span><span class="o">+</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="s">'Negativos'</span>
        <span class="n">hoja</span><span class="p">[</span><span class="s">'A'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nf</span><span class="o">+</span><span class="mi">3</span><span class="p">)]</span> <span class="o">=</span> <span class="s">'Ceros'</span>
        
        <span class="n">hoja</span><span class="p">[</span><span class="s">'B'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nf</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span>  <span class="sa">f</span><span class="s">'=COUNTIF($C$</span><span class="si">{</span><span class="n">ix01</span><span class="si">}</span><span class="s">:$C$</span><span class="si">{</span><span class="n">ix02</span><span class="si">}</span><span class="s">,"&gt;0")'</span>
        <span class="n">hoja</span><span class="p">[</span><span class="s">'B'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nf</span><span class="o">+</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'=COUNTIF($C$</span><span class="si">{</span><span class="n">ix01</span><span class="si">}</span><span class="s">:$C$</span><span class="si">{</span><span class="n">ix02</span><span class="si">}</span><span class="s">,"&lt;0")'</span>
        <span class="n">hoja</span><span class="p">[</span><span class="s">'B'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nf</span><span class="o">+</span><span class="mi">3</span><span class="p">)]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'=COUNTIF($C$</span><span class="si">{</span><span class="n">ix01</span><span class="si">}</span><span class="s">:$C$</span><span class="si">{</span><span class="n">ix02</span><span class="si">}</span><span class="s">,"0")'</span>
        
        <span class="k">return</span> <span class="n">hoja</span>
    
    <span class="k">def</span> <span class="nf">formatos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1"># hoja = self.libro.active
</span>        
        <span class="n">hoja</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">libro</span><span class="p">[</span><span class="s">'Despues'</span><span class="p">]</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">sheet_view</span><span class="p">.</span><span class="n">showGridLines</span> <span class="o">=</span> <span class="bp">False</span> <span class="c1"># bordes de línea
</span>        
        <span class="n">hoja</span><span class="p">.</span><span class="n">row_dimensions</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">7</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">row_dimensions</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">22</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">row_dimensions</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">22</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">row_dimensions</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">22</span>
        
        <span class="c1"># formato a titulo de la hoja 
</span>        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                
                <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="s">'form_titulo'</span>
                
        <span class="c1"># formato a los encabezados de columnas
</span>        
        <span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            
            <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="s">'enc_col'</span>
            
        <span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span>
            
            <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="s">'enc_col'</span>
            
        <span class="c1"># formato para resto de filas
</span>        <span class="n">idx</span> <span class="o">=</span> <span class="n">hoja</span><span class="p">.</span><span class="n">min_row</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">12</span>
        
        <span class="n">filapar</span> <span class="o">=</span> <span class="n">PatternFill</span><span class="p">(</span><span class="n">fgColor</span> <span class="o">=</span> <span class="s">'ecf7f9'</span><span class="p">,</span>
                   <span class="n">fill_type</span><span class="o">=</span><span class="s">'solid'</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx2</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                
                <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    
                    <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="s">'form_fila'</span>
                    
                    <span class="n">celda</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">filapar</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="s">'form_fila'</span>
                    
        <span class="c1"># ancho de columnas
</span>                    
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hoja</span><span class="p">.</span><span class="n">max_column</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            
            <span class="n">idx_col</span> <span class="o">=</span> <span class="n">get_column_letter</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            
            <span class="n">hoja</span><span class="p">.</span><span class="n">column_dimensions</span><span class="p">[</span><span class="n">idx_col</span><span class="p">].</span><span class="n">width</span> <span class="o">=</span> <span class="mi">14</span>
            
        <span class="c1"># segunda tabla
</span>        <span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span>
            
            <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="s">'enc_col'</span>
            
        <span class="c1">## filas de 2nda tabla
</span>        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">celda</span> <span class="ow">in</span> <span class="n">hoja</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                
                <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    
                    <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="s">'form_fila'</span>
                    
                    <span class="n">celda</span><span class="p">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">filapar</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="n">celda</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="s">'form_fila'</span>
                    
        <span class="k">return</span> <span class="n">hoja</span>
    
    <span class="k">def</span> <span class="nf">grafico_linea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">ejex</span><span class="o">=</span><span class="s">"Mes"</span><span class="p">,</span>
                      <span class="n">ejey</span><span class="o">=</span><span class="s">"$"</span><span class="p">,</span>
                      <span class="n">titulo</span><span class="o">=</span><span class="s">"Montos Mensuales"</span><span class="p">):</span>
        
        <span class="c1"># hoja = self.libro.active
</span>        <span class="n">hoja</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">libro</span><span class="p">[</span><span class="s">'Despues'</span><span class="p">]</span>
        
        <span class="n">linea</span> <span class="o">=</span> <span class="n">LineChart</span><span class="p">()</span>
        
        <span class="n">linea</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"line"</span>
        
        <span class="n">linea</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="mi">10</span>
        
        <span class="n">linea</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">titulo</span>
        
        <span class="n">linea</span><span class="p">.</span><span class="n">y_axis</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">ejey</span>
        
        <span class="n">linea</span><span class="p">.</span><span class="n">x_axis</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">ejex</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">Reference</span><span class="p">(</span><span class="n">worksheet</span><span class="o">=</span><span class="n">hoja</span><span class="p">,</span>
                         
                         <span class="n">min_row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                         
                         <span class="n">max_row</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                         
                         <span class="n">min_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         
                         <span class="n">max_col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">linea</span><span class="p">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">from_rows</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                       
                       <span class="n">titles_from_data</span><span class="o">=</span><span class="bp">True</span>
                      <span class="p">)</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">add_chart</span><span class="p">(</span><span class="n">linea</span><span class="p">,</span> <span class="s">"E3"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">hoja</span>
    
    <span class="k">def</span> <span class="nf">grafico_barra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">ejex</span><span class="o">=</span><span class="s">"Categoria"</span><span class="p">,</span>
                      
                      <span class="n">ejey</span><span class="o">=</span><span class="s">"Conteo"</span><span class="p">,</span>
                      
                      <span class="n">titulo</span><span class="o">=</span><span class="s">"Cambio % Positivo-Negativo"</span><span class="p">):</span>
        
        <span class="c1"># hoja = self.libro.active
</span>        <span class="n">hoja</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">libro</span><span class="p">[</span><span class="s">'Despues'</span><span class="p">]</span>
        
        <span class="n">barra</span> <span class="o">=</span> <span class="n">BarChart</span><span class="p">()</span>
        
        <span class="n">barra</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"col"</span>
        
        <span class="n">barra</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="mi">9</span>
        
        <span class="n">barra</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Positivos y negativos"</span>
        
        <span class="n">barra</span><span class="p">.</span><span class="n">y_axis</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'Conteo'</span>
        
        <span class="n">barra</span><span class="p">.</span><span class="n">x_axis</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'Categoria'</span>
        
        <span class="n">data1</span> <span class="o">=</span> <span class="n">Reference</span><span class="p">(</span><span class="n">worksheet</span><span class="o">=</span><span class="n">hoja</span><span class="p">,</span>
                          
                          <span class="n">min_row</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span>
                          
                          <span class="n">max_row</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                          
                          <span class="n">min_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          
                          <span class="n">max_col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">barra</span><span class="p">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">titles_from_data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">hoja</span><span class="p">.</span><span class="n">add_chart</span><span class="p">(</span><span class="n">barra</span><span class="p">,</span> <span class="s">"E22"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">hoja</span>

</code></pre></div></div>

<p>En conclusión, estos modulos y funciones pueden ser muy útiles para situaciones en las que puedan anticiparse el tipo de operaciones y formatos que serán requeridos, y sobre todo si se trata de tareas que deben ejecutarse de modo reiterado.</p>

  </div><a class="u-url" href="/apuntes/2023/07/15/XLatravespython.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <!--<a href="http://localhost:4000/feed.xml"> -->
           <!--<svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>-->
              </use><svg class="svg-icon orange" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
</svg>
 
              
            </svg><span>Notas y Códigos</span>
          </a> 
        </p>
      </div>
      <div class="footer-col">
        <!--<p>Notas y Códigos sobre Python</p>-->
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
